# resolv.confとDNSの仕組み

WSLでUbuntsを利用していると、時々インターネットに接続できないエラーが発生します(VirtualboxでCentOSを利用している時もたまに起こります)。  
そんな時は、/etc/resolv.confを修正することで解決されることがあります。  
/etc/resolv.confに以下の情報を記載します。  
```
nameserver 8.8.8.8 # またはnameserver 1.1.1.1
```
/etc/resolv.confは名前解決に使用するDNSサーバを指定します(複数指定可能) 。  
8.8.8.8や1.1.1.1はパブリックDNSサーバで、それぞれGoogleとCloudflareによって提供されています。  
DNSサーバにパブリックDNSサーバを指定することによって正しく名前解決され、
エラーは解消されます。めでたしめでたし。。。  
というふうにやんわり理解はできるのですが、しっくりこない。  
もっとDNSの仕組みについて深掘りするとより理解できます。  

## 名前解決とは？
DNSサーバへ問い合わせをし、ドメインに紐づくIPアドレスを取得することです。  
DNSサーバにはフルリゾルバ、権威サーバがあります。  

## DNSの仕組み
DNSの仕組みを図にまとめました。  
![dns-system.jpg](https://raw.githubusercontent.com/JinKanekama/article/main/images/dns_system.jpg)
<br>
スタブリゾルバ、フルリゾルバ、権威サーバの役割を整理します。  
### スタブリゾルバ
スタブリゾルバは自身では名前解決は行わず、フルリゾルバへ名前解決の**依頼**をします。  
また、スタブリゾルバは我々が普段使うノートPCやスマホなどのクライアント端末に標準で装備されています。  
### フルリゾルバ
権威サーバとやりとりし、名前解決を行います。  

### 権威サーバ
ドメインに紐づくIPアドレスの情報を管理します。名前解決の問い合わせが来たら、
ドメインに紐付くIPアドレスを返します(厳密に言うと委任情報かIPアドレスを返すのですが、ここでは割愛します)。  

## /etc/resolv.confの修正では何をしていたか？
/etc/resolv.confの修正では、DNSサーバーにフルリゾルバの8.8.8.8(パブリックDNS)を指定しています。  
名前解決の際、UbuntsサーバはパブリックDNSサーバへexample.comの名前解決をして！というように名前解決を依頼し、
パブリックDNSサーバは権威サーバとやりとりし、お目当てのドメインのIPアドレスを見つけてきます。  

構成は以下の通りです。  
スタブリゾルバ：ubuntsサーバ  
フルリゾルバ：8.8.8.8(パブリックDNSサーバ)  

## 最後に
この記事が皆さんのDNSへの理解につながりますと幸いです。
